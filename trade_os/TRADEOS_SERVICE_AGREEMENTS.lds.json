{
  "_lds": {
    "uuid": "tradeos-service-agreements-2026-001",
    "type": "ui_component",
    "version": "1.0.0",
    "created": "2026-01-14T03:30:00Z",
    "parent": "tradeos-master-2026-001",
    "phase": 5,
    "sequence": 3
  },
  "core": {
    "name": "TradeOS Service Agreements",
    "description": "Membership plans, recurring billing, equipment registry, and renewal management.",
    "principle": "Admin can plan:create, plan:delete. Office can enrollment:create. Cancellations require approval."
  },
  "features": {
    "plan_builder": "Create tiered membership plans with pricing and benefits",
    "customer_enrollment": "Enroll customers in service agreements",
    "recurring_billing": "Automated billing schedules",
    "equipment_registry": "Track customer equipment with service history",
    "maintenance_scheduling": "Schedule maintenance visits per agreement",
    "renewal_reminders": "30/60/90 day renewal notifications",
    "cancellation_handling": "Process cancellations with reason tracking",
    "revenue_recognition": "Track MRR and agreement revenue"
  },
  "react_component": {
    "filename": "ServiceAgreements.tsx",
    "code": "import React, { useState, useCallback } from 'react';\nimport { FileText, Users, Calendar, DollarSign, Plus, X, Settings, AlertTriangle, CheckCircle2, Clock, RefreshCw, Wrench, Home, ChevronRight, ChevronDown, Edit, Trash2, Bell, TrendingUp, Package } from 'lucide-react';\nimport { useKernel } from './LDSKernel';\n\ntype PlanTier = 'bronze' | 'silver' | 'gold';\ntype AgreementStatus = 'active' | 'pending' | 'expiring' | 'expired' | 'cancelled';\ntype BillingFrequency = 'monthly' | 'quarterly' | 'annual';\n\ninterface ServicePlan {\n  id: string;\n  name: string;\n  tier: PlanTier;\n  price: number;\n  billingFrequency: BillingFrequency;\n  benefits: string[];\n  maintenanceVisits: number;\n  discountPercent: number;\n  priorityService: boolean;\n  active: boolean;\n}\n\ninterface Equipment {\n  id: string;\n  type: string;\n  brand: string;\n  model: string;\n  serialNumber: string;\n  installDate: string;\n  warrantyExpires?: string;\n  lastService?: string;\n  nextService?: string;\n}\n\ninterface Agreement {\n  id: string;\n  customerId: string;\n  customerName: string;\n  customerEmail: string;\n  customerAddress: string;\n  planId: string;\n  planName: string;\n  planTier: PlanTier;\n  status: AgreementStatus;\n  startDate: string;\n  endDate: string;\n  renewalDate: string;\n  billingFrequency: BillingFrequency;\n  monthlyRate: number;\n  equipment: Equipment[];\n  visitsUsed: number;\n  visitsIncluded: number;\n  autoRenew: boolean;\n  cancelReason?: string;\n}\n\nconst PLANS: ServicePlan[] = [\n  { id: 'plan-1', name: 'Bronze Care', tier: 'bronze', price: 12.99, billingFrequency: 'monthly', benefits: ['Annual tune-up', '10% parts discount', 'Priority scheduling'], maintenanceVisits: 1, discountPercent: 10, priorityService: true, active: true },\n  { id: 'plan-2', name: 'Silver Care', tier: 'silver', price: 19.99, billingFrequency: 'monthly', benefits: ['2 tune-ups per year', '15% parts discount', 'Priority scheduling', 'No overtime charges'], maintenanceVisits: 2, discountPercent: 15, priorityService: true, active: true },\n  { id: 'plan-3', name: 'Gold Care', tier: 'gold', price: 29.99, billingFrequency: 'monthly', benefits: ['Quarterly tune-ups', '20% parts discount', 'Priority scheduling', 'No overtime charges', 'No diagnostic fees', '24/7 emergency line'], maintenanceVisits: 4, discountPercent: 20, priorityService: true, active: true }\n];\n\nconst AGREEMENTS: Agreement[] = [\n  {\n    id: 'agr-1', customerId: 'cust-1', customerName: 'Johnson Residence', customerEmail: 'johnson@email.com', customerAddress: '123 Oak St, Philadelphia, PA',\n    planId: 'plan-3', planName: 'Gold Care', planTier: 'gold', status: 'active', startDate: '2025-06-15', endDate: '2026-06-15', renewalDate: '2026-06-15',\n    billingFrequency: 'monthly', monthlyRate: 29.99, visitsUsed: 2, visitsIncluded: 4, autoRenew: true,\n    equipment: [\n      { id: 'eq-1', type: 'HVAC', brand: 'Carrier', model: '24ACC636A003', serialNumber: 'CAR-2024-78542', installDate: '2024-03-15', warrantyExpires: '2029-03-15', lastService: '2025-12-10', nextService: '2026-03-10' },\n      { id: 'eq-2', type: 'Water Heater', brand: 'Rheem', model: 'PROG50-38N RH67', serialNumber: 'RHM-2023-45621', installDate: '2023-08-20', warrantyExpires: '2029-08-20', lastService: '2025-08-20' }\n    ]\n  },\n  {\n    id: 'agr-2', customerId: 'cust-2', customerName: 'Smith Commercial', customerEmail: 'smith@company.com', customerAddress: '456 Main Ave, Philadelphia, PA',\n    planId: 'plan-2', planName: 'Silver Care', planTier: 'silver', status: 'active', startDate: '2025-09-01', endDate: '2026-09-01', renewalDate: '2026-09-01',\n    billingFrequency: 'monthly', monthlyRate: 19.99, visitsUsed: 1, visitsIncluded: 2, autoRenew: true,\n    equipment: [\n      { id: 'eq-3', type: 'HVAC', brand: 'Trane', model: 'XR15', serialNumber: 'TRN-2022-98765', installDate: '2022-05-10', warrantyExpires: '2027-05-10', lastService: '2025-11-15' }\n    ]\n  },\n  {\n    id: 'agr-3', customerId: 'cust-3', customerName: 'Davis Home', customerEmail: 'davis@email.com', customerAddress: '789 Pine Rd, Philadelphia, PA',\n    planId: 'plan-1', planName: 'Bronze Care', planTier: 'bronze', status: 'expiring', startDate: '2025-02-01', endDate: '2026-02-01', renewalDate: '2026-02-01',\n    billingFrequency: 'monthly', monthlyRate: 12.99, visitsUsed: 1, visitsIncluded: 1, autoRenew: false,\n    equipment: [\n      { id: 'eq-4', type: 'Furnace', brand: 'Lennox', model: 'EL296V', serialNumber: 'LNX-2020-12345', installDate: '2020-11-01', lastService: '2025-10-01' }\n    ]\n  },\n  {\n    id: 'agr-4', customerId: 'cust-4', customerName: 'Garcia Home', customerEmail: 'garcia@email.com', customerAddress: '654 Elm Ave, Philadelphia, PA',\n    planId: 'plan-2', planName: 'Silver Care', planTier: 'silver', status: 'pending', startDate: '2026-02-01', endDate: '2027-02-01', renewalDate: '2027-02-01',\n    billingFrequency: 'annual', monthlyRate: 19.99, visitsUsed: 0, visitsIncluded: 2, autoRenew: true,\n    equipment: []\n  },\n  {\n    id: 'agr-5', customerId: 'cust-5', customerName: 'Wilson Property', customerEmail: 'wilson@email.com', customerAddress: '321 Elm St, Philadelphia, PA',\n    planId: 'plan-1', planName: 'Bronze Care', planTier: 'bronze', status: 'cancelled', startDate: '2024-08-01', endDate: '2025-08-01', renewalDate: '2025-08-01',\n    billingFrequency: 'monthly', monthlyRate: 12.99, visitsUsed: 1, visitsIncluded: 1, autoRenew: false, cancelReason: 'Sold property',\n    equipment: []\n  }\n];\n\nconst TIER_CONFIG: Record<PlanTier, { label: string; color: string; bg: string }> = {\n  bronze: { label: 'Bronze', color: 'text-amber-700', bg: 'bg-amber-100' },\n  silver: { label: 'Silver', color: 'text-slate-600', bg: 'bg-slate-200' },\n  gold: { label: 'Gold', color: 'text-yellow-700', bg: 'bg-yellow-100' }\n};\n\nconst STATUS_CONFIG: Record<AgreementStatus, { label: string; color: string; bg: string; icon: React.ReactNode }> = {\n  active: { label: 'Active', color: 'text-green-700', bg: 'bg-green-100', icon: <CheckCircle2 className=\"w-4 h-4\" /> },\n  pending: { label: 'Pending', color: 'text-blue-700', bg: 'bg-blue-100', icon: <Clock className=\"w-4 h-4\" /> },\n  expiring: { label: 'Expiring Soon', color: 'text-amber-700', bg: 'bg-amber-100', icon: <AlertTriangle className=\"w-4 h-4\" /> },\n  expired: { label: 'Expired', color: 'text-red-700', bg: 'bg-red-100', icon: <AlertTriangle className=\"w-4 h-4\" /> },\n  cancelled: { label: 'Cancelled', color: 'text-slate-600', bg: 'bg-slate-100', icon: <X className=\"w-4 h-4\" /> }\n};\n\ntype ViewMode = 'agreements' | 'plans' | 'renewals' | 'equipment';\n\nexport const ServiceAgreements: React.FC = () => {\n  const { validate, role } = useKernel();\n  const [viewMode, setViewMode] = useState<ViewMode>('agreements');\n  const [agreements, setAgreements] = useState<Agreement[]>(AGREEMENTS);\n  const [plans, setPlans] = useState<ServicePlan[]>(PLANS);\n  const [selectedAgreement, setSelectedAgreement] = useState<Agreement | null>(null);\n  const [showEnroll, setShowEnroll] = useState(false);\n  const [showAddEquipment, setShowAddEquipment] = useState(false);\n  const [expandedPlan, setExpandedPlan] = useState<string | null>(null);\n\n  const handleEnroll = useCallback(() => {\n    const result = validate('enrollment:create', { authenticated: true });\n    if (result.result !== 'ALLOWED') {\n      alert(`Enrollment denied: ${result.reason}`);\n      return;\n    }\n    setShowEnroll(true);\n  }, [validate]);\n\n  const handleCreatePlan = useCallback(() => {\n    const result = validate('plan:create', { authenticated: true, mfa_verified: true });\n    if (result.result !== 'ALLOWED') {\n      alert(`Create plan denied: ${result.reason}`);\n      return;\n    }\n    alert('Plan creation form would open here');\n  }, [validate]);\n\n  const handleCancel = useCallback((agreementId: string) => {\n    const result = validate('agreement:cancel', { authenticated: true });\n    if (result.result !== 'ALLOWED') {\n      alert(`Cancellation denied: ${result.reason}`);\n      return;\n    }\n    const reason = prompt('Please enter cancellation reason:');\n    if (reason) {\n      setAgreements(prev => prev.map(a => a.id === agreementId ? { ...a, status: 'cancelled' as AgreementStatus, cancelReason: reason } : a));\n      alert('Agreement cancelled.');\n    }\n  }, [validate]);\n\n  const handleRenew = useCallback((agreementId: string) => {\n    const result = validate('agreement:renew', { authenticated: true });\n    if (result.result !== 'ALLOWED') {\n      alert(`Renewal denied: ${result.reason}`);\n      return;\n    }\n    setAgreements(prev => prev.map(a => {\n      if (a.id === agreementId) {\n        const newEnd = new Date(a.endDate);\n        newEnd.setFullYear(newEnd.getFullYear() + 1);\n        return { ...a, status: 'active' as AgreementStatus, endDate: newEnd.toISOString().split('T')[0], renewalDate: newEnd.toISOString().split('T')[0], visitsUsed: 0 };\n      }\n      return a;\n    }));\n    alert('Agreement renewed for another year!');\n  }, [validate]);\n\n  const activeAgreements = agreements.filter(a => a.status === 'active').length;\n  const mrr = agreements.filter(a => a.status === 'active').reduce((s, a) => s + a.monthlyRate, 0);\n  const expiringCount = agreements.filter(a => a.status === 'expiring').length;\n  const totalEquipment = agreements.reduce((s, a) => s + a.equipment.length, 0);\n\n  const AgreementsView = () => (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <div className=\"bg-white rounded-xl border border-slate-200 p-4\">\n          <p className=\"text-sm text-slate-500\">Active Agreements</p>\n          <p className=\"text-2xl font-bold text-slate-800\">{activeAgreements}</p>\n        </div>\n        <div className=\"bg-white rounded-xl border border-green-200 p-4\">\n          <p className=\"text-sm text-green-600\">Monthly Recurring</p>\n          <p className=\"text-2xl font-bold text-green-600\">${mrr.toFixed(2)}</p>\n        </div>\n        <div className=\"bg-white rounded-xl border border-amber-200 p-4\">\n          <p className=\"text-sm text-amber-600\">Expiring Soon</p>\n          <p className=\"text-2xl font-bold text-amber-600\">{expiringCount}</p>\n        </div>\n        <div className=\"bg-white rounded-xl border border-slate-200 p-4\">\n          <p className=\"text-sm text-slate-500\">Equipment Tracked</p>\n          <p className=\"text-2xl font-bold text-slate-800\">{totalEquipment}</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-1 space-y-3\">\n          {agreements.map((agr) => {\n            const tierConf = TIER_CONFIG[agr.planTier];\n            const statusConf = STATUS_CONFIG[agr.status];\n            return (\n              <div key={agr.id} onClick={() => setSelectedAgreement(agr)} className={`bg-white rounded-xl border p-4 cursor-pointer transition-all hover:border-slate-300 ${selectedAgreement?.id === agr.id ? 'border-orange-500 ring-2 ring-orange-200' : 'border-slate-200'}`}>\n                <div className=\"flex items-start justify-between mb-2\">\n                  <div>\n                    <p className=\"font-semibold text-slate-800\">{agr.customerName}</p>\n                    <div className=\"flex items-center gap-2 mt-1\">\n                      <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${tierConf.bg} ${tierConf.color}`}>{agr.planName}</span>\n                    </div>\n                  </div>\n                  <span className={`px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${statusConf.bg} ${statusConf.color}`}>\n                    {statusConf.icon}{statusConf.label}\n                  </span>\n                </div>\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-slate-500\">Renews: {agr.renewalDate}</span>\n                  <span className=\"font-bold text-slate-800\">${agr.monthlyRate}/mo</span>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n\n        {selectedAgreement ? (\n          <div className=\"lg:col-span-2 bg-white rounded-xl border border-slate-200 overflow-hidden\">\n            <div className=\"p-4 border-b border-slate-100 bg-slate-50\">\n              <div className=\"flex items-start justify-between\">\n                <div>\n                  <h2 className=\"text-xl font-bold text-slate-800\">{selectedAgreement.customerName}</h2>\n                  <p className=\"text-sm text-slate-500\">{selectedAgreement.customerEmail}</p>\n                  <p className=\"text-sm text-slate-500\">{selectedAgreement.customerAddress}</p>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  {selectedAgreement.status === 'expiring' && (\n                    <button onClick={() => handleRenew(selectedAgreement.id)} className=\"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 flex items-center gap-2\">\n                      <RefreshCw className=\"w-4 h-4\" /> Renew\n                    </button>\n                  )}\n                  {selectedAgreement.status === 'active' && (\n                    <button onClick={() => handleCancel(selectedAgreement.id)} className=\"px-4 py-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50\">Cancel</button>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            <div className=\"p-4 space-y-6\">\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <div className=\"p-3 bg-slate-50 rounded-lg\">\n                  <p className=\"text-sm text-slate-500\">Plan</p>\n                  <p className=\"font-medium text-slate-800\">{selectedAgreement.planName}</p>\n                </div>\n                <div className=\"p-3 bg-slate-50 rounded-lg\">\n                  <p className=\"text-sm text-slate-500\">Rate</p>\n                  <p className=\"font-medium text-slate-800\">${selectedAgreement.monthlyRate}/mo</p>\n                </div>\n                <div className=\"p-3 bg-slate-50 rounded-lg\">\n                  <p className=\"text-sm text-slate-500\">Visits Used</p>\n                  <p className=\"font-medium text-slate-800\">{selectedAgreement.visitsUsed} / {selectedAgreement.visitsIncluded}</p>\n                </div>\n                <div className=\"p-3 bg-slate-50 rounded-lg\">\n                  <p className=\"text-sm text-slate-500\">Auto-Renew</p>\n                  <p className={`font-medium ${selectedAgreement.autoRenew ? 'text-green-600' : 'text-slate-600'}`}>{selectedAgreement.autoRenew ? 'Yes' : 'No'}</p>\n                </div>\n              </div>\n\n              <div>\n                <div className=\"flex items-center justify-between mb-3\">\n                  <h3 className=\"font-semibold text-slate-800\">Equipment Registry</h3>\n                  <button onClick={() => setShowAddEquipment(true)} className=\"px-3 py-1.5 text-sm bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 flex items-center gap-1\">\n                    <Plus className=\"w-4 h-4\" /> Add Equipment\n                  </button>\n                </div>\n                {selectedAgreement.equipment.length > 0 ? (\n                  <div className=\"space-y-3\">\n                    {selectedAgreement.equipment.map((eq) => (\n                      <div key={eq.id} className=\"p-4 border border-slate-200 rounded-lg\">\n                        <div className=\"flex items-start justify-between\">\n                          <div>\n                            <div className=\"flex items-center gap-2\">\n                              <Wrench className=\"w-4 h-4 text-slate-400\" />\n                              <p className=\"font-medium text-slate-800\">{eq.type}</p>\n                            </div>\n                            <p className=\"text-sm text-slate-600\">{eq.brand} {eq.model}</p>\n                            <p className=\"text-xs text-slate-400\">S/N: {eq.serialNumber}</p>\n                          </div>\n                          <div className=\"text-right text-sm\">\n                            <p className=\"text-slate-500\">Installed: {eq.installDate}</p>\n                            {eq.warrantyExpires && <p className=\"text-slate-500\">Warranty: {eq.warrantyExpires}</p>}\n                          </div>\n                        </div>\n                        {eq.lastService && (\n                          <div className=\"mt-3 pt-3 border-t border-slate-100 flex items-center justify-between text-sm\">\n                            <span className=\"text-slate-500\">Last Service: {eq.lastService}</span>\n                            {eq.nextService && <span className=\"text-blue-600\">Next: {eq.nextService}</span>}\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-8 text-slate-500\">\n                    <Package className=\"w-12 h-12 mx-auto mb-2 text-slate-300\" />\n                    <p>No equipment registered</p>\n                  </div>\n                )}\n              </div>\n\n              {selectedAgreement.cancelReason && (\n                <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg\">\n                  <p className=\"text-sm text-red-600\">Cancellation Reason: {selectedAgreement.cancelReason}</p>\n                </div>\n              )}\n            </div>\n          </div>\n        ) : (\n          <div className=\"lg:col-span-2 bg-white rounded-xl border border-slate-200 flex items-center justify-center h-96\">\n            <div className=\"text-center text-slate-500\">\n              <FileText className=\"w-12 h-12 mx-auto mb-2 text-slate-300\" />\n              <p>Select an agreement to view details</p>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  const PlansView = () => (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"font-semibold text-slate-800\">Service Plans</h3>\n        {role === 'admin' && (\n          <button onClick={handleCreatePlan} className=\"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 flex items-center gap-2\">\n            <Plus className=\"w-4 h-4\" /> New Plan\n          </button>\n        )}\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        {plans.map((plan) => {\n          const tierConf = TIER_CONFIG[plan.tier];\n          const isExpanded = expandedPlan === plan.id;\n          return (\n            <div key={plan.id} className={`bg-white rounded-xl border-2 overflow-hidden ${plan.tier === 'gold' ? 'border-yellow-400' : plan.tier === 'silver' ? 'border-slate-300' : 'border-amber-300'}`}>\n              <div className={`p-4 ${tierConf.bg}`}>\n                <div className=\"flex items-center justify-between\">\n                  <span className={`px-3 py-1 rounded-full text-sm font-bold ${tierConf.color} bg-white`}>{tierConf.label}</span>\n                  {plan.tier === 'gold' && <span className=\"text-xs text-yellow-700 font-medium\">MOST POPULAR</span>}\n                </div>\n                <h3 className=\"text-xl font-bold text-slate-800 mt-3\">{plan.name}</h3>\n                <div className=\"mt-2\">\n                  <span className=\"text-3xl font-bold text-slate-800\">${plan.price}</span>\n                  <span className=\"text-slate-500\">/{plan.billingFrequency === 'monthly' ? 'mo' : plan.billingFrequency === 'quarterly' ? 'qtr' : 'yr'}</span>\n                </div>\n              </div>\n              <div className=\"p-4\">\n                <ul className=\"space-y-2\">\n                  {plan.benefits.map((benefit, i) => (\n                    <li key={i} className=\"flex items-start gap-2 text-sm\">\n                      <CheckCircle2 className=\"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0\" />\n                      <span className=\"text-slate-700\">{benefit}</span>\n                    </li>\n                  ))}\n                </ul>\n                <div className=\"mt-4 pt-4 border-t border-slate-100 grid grid-cols-2 gap-3 text-sm\">\n                  <div><p className=\"text-slate-500\">Visits/Year</p><p className=\"font-medium text-slate-800\">{plan.maintenanceVisits}</p></div>\n                  <div><p className=\"text-slate-500\">Parts Discount</p><p className=\"font-medium text-slate-800\">{plan.discountPercent}%</p></div>\n                </div>\n                <button onClick={() => setShowEnroll(true)} className=\"w-full mt-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600\">Enroll Customer</button>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n\n  const RenewalsView = () => {\n    const upcoming = agreements.filter(a => a.status === 'expiring' || (a.status === 'active' && new Date(a.renewalDate) < new Date(Date.now() + 90 * 24 * 60 * 60 * 1000)));\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"bg-white rounded-xl border border-slate-200 p-6\">\n          <h3 className=\"font-semibold text-slate-800 mb-4\">Upcoming Renewals (Next 90 Days)</h3>\n          {upcoming.length > 0 ? (\n            <div className=\"space-y-3\">\n              {upcoming.map((agr) => {\n                const daysUntil = Math.ceil((new Date(agr.renewalDate).getTime() - Date.now()) / (1000 * 60 * 60 * 24));\n                return (\n                  <div key={agr.id} className={`p-4 rounded-lg border ${daysUntil <= 30 ? 'border-red-200 bg-red-50' : daysUntil <= 60 ? 'border-amber-200 bg-amber-50' : 'border-slate-200 bg-slate-50'}`}>\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"font-medium text-slate-800\">{agr.customerName}</p>\n                        <p className=\"text-sm text-slate-500\">{agr.planName} â€¢ ${agr.monthlyRate}/mo</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className={`font-bold ${daysUntil <= 30 ? 'text-red-600' : daysUntil <= 60 ? 'text-amber-600' : 'text-slate-800'}`}>{daysUntil} days</p>\n                        <p className=\"text-sm text-slate-500\">{agr.renewalDate}</p>\n                      </div>\n                    </div>\n                    <div className=\"mt-3 flex items-center gap-2\">\n                      <button className=\"px-3 py-1.5 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 flex items-center gap-1\"><Bell className=\"w-3 h-3\" /> Send Reminder</button>\n                      <button onClick={() => handleRenew(agr.id)} className=\"px-3 py-1.5 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 flex items-center gap-1\"><RefreshCw className=\"w-3 h-3\" /> Renew Now</button>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          ) : (\n            <p className=\"text-slate-500 text-center py-8\">No upcoming renewals</p>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  const EquipmentView = () => {\n    const allEquipment = agreements.flatMap(a => a.equipment.map(e => ({ ...e, customerName: a.customerName, agreementId: a.id })));\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"bg-white rounded-xl border border-slate-200 overflow-hidden\">\n          <div className=\"p-4 border-b border-slate-100\">\n            <h3 className=\"font-semibold text-slate-800\">All Registered Equipment</h3>\n          </div>\n          <table className=\"w-full\">\n            <thead className=\"bg-slate-50\">\n              <tr>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Equipment</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Customer</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Serial #</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Installed</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Last Service</th>\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase\">Next Service</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-slate-100\">\n              {allEquipment.map((eq) => (\n                <tr key={eq.id} className=\"hover:bg-slate-50\">\n                  <td className=\"px-4 py-4\">\n                    <p className=\"font-medium text-slate-800\">{eq.type}</p>\n                    <p className=\"text-sm text-slate-500\">{eq.brand} {eq.model}</p>\n                  </td>\n                  <td className=\"px-4 py-4 text-slate-700\">{eq.customerName}</td>\n                  <td className=\"px-4 py-4 text-sm font-mono text-slate-600\">{eq.serialNumber}</td>\n                  <td className=\"px-4 py-4 text-sm text-slate-600\">{eq.installDate}</td>\n                  <td className=\"px-4 py-4 text-sm text-slate-600\">{eq.lastService || '-'}</td>\n                  <td className=\"px-4 py-4 text-sm\">{eq.nextService ? <span className=\"text-blue-600\">{eq.nextService}</span> : '-'}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div><h1 className=\"text-2xl font-bold text-slate-800\">Service Agreements</h1><p className=\"text-slate-500\">Membership plans and recurring revenue</p></div>\n        <button onClick={handleEnroll} className=\"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 flex items-center gap-2\"><Plus className=\"w-4 h-4\" /> Enroll Customer</button>\n      </div>\n\n      <div className=\"bg-white rounded-xl border border-slate-200 p-1 inline-flex flex-wrap gap-1\">\n        {[{ id: 'agreements', label: 'Agreements', icon: <FileText className=\"w-4 h-4\" /> },\n          { id: 'plans', label: 'Plans', icon: <Settings className=\"w-4 h-4\" /> },\n          { id: 'renewals', label: 'Renewals', icon: <RefreshCw className=\"w-4 h-4\" />, badge: expiringCount },\n          { id: 'equipment', label: 'Equipment', icon: <Wrench className=\"w-4 h-4\" /> }\n        ].map((v) => (\n          <button key={v.id} onClick={() => setViewMode(v.id as ViewMode)} className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${viewMode === v.id ? 'bg-orange-100 text-orange-700' : 'text-slate-600 hover:text-slate-800'}`}>\n            {v.icon}{v.label}{v.badge && v.badge > 0 && (<span className=\"px-1.5 py-0.5 bg-amber-500 text-white text-xs rounded-full\">{v.badge}</span>)}\n          </button>\n        ))}\n      </div>\n\n      {viewMode === 'agreements' && <AgreementsView />}\n      {viewMode === 'plans' && <PlansView />}\n      {viewMode === 'renewals' && <RenewalsView />}\n      {viewMode === 'equipment' && <EquipmentView />}\n\n      {showEnroll && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-2xl w-full max-w-lg mx-4\">\n            <div className=\"p-4 border-b border-slate-200 flex items-center justify-between\">\n              <h3 className=\"font-semibold text-slate-800\">Enroll Customer</h3>\n              <button onClick={() => setShowEnroll(false)} className=\"p-2 hover:bg-slate-100 rounded-lg\"><X className=\"w-5 h-5 text-slate-600\" /></button>\n            </div>\n            <div className=\"p-4 space-y-4\">\n              <div><label className=\"block text-sm font-medium text-slate-700 mb-1\">Customer</label><select className=\"w-full px-4 py-2 border border-slate-200 rounded-lg\"><option>Select customer...</option><option>Johnson Residence</option><option>Smith Commercial</option><option>Davis Home</option></select></div>\n              <div><label className=\"block text-sm font-medium text-slate-700 mb-1\">Service Plan</label><select className=\"w-full px-4 py-2 border border-slate-200 rounded-lg\">{plans.map(p => (<option key={p.id} value={p.id}>{p.name} - ${p.price}/mo</option>))}</select></div>\n              <div><label className=\"block text-sm font-medium text-slate-700 mb-1\">Billing Frequency</label><select className=\"w-full px-4 py-2 border border-slate-200 rounded-lg\"><option value=\"monthly\">Monthly</option><option value=\"quarterly\">Quarterly</option><option value=\"annual\">Annual (10% discount)</option></select></div>\n              <div><label className=\"block text-sm font-medium text-slate-700 mb-1\">Start Date</label><input type=\"date\" className=\"w-full px-4 py-2 border border-slate-200 rounded-lg\" /></div>\n              <label className=\"flex items-center gap-2\"><input type=\"checkbox\" defaultChecked className=\"w-4 h-4 text-orange-500\" /><span className=\"text-sm text-slate-700\">Enable auto-renewal</span></label>\n              <div className=\"flex gap-3\">\n                <button onClick={() => setShowEnroll(false)} className=\"flex-1 py-2 border border-slate-200 text-slate-700 rounded-lg hover:bg-slate-50\">Cancel</button>\n                <button onClick={() => { setShowEnroll(false); alert('Customer enrolled!'); }} className=\"flex-1 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600\">Enroll</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showAddEquipment && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-2xl w-full max-w-lg mx-4\">\n            <div className=\"p-4 border-b border-slate-200 flex items-center justify-between\">\n              <h3 className=\"font-semibold text-slate-800\">Add Equipment</h3>\n              <button onClick={() => setShowAddEquipment(false)} className=\"p-2 hover:bg-slate-100 rounded-lg\"><X className=\"w-5 h-5 text-slate-600\" /></button>\n            </div>\n            <div className=\"p-4 space-y-4\">\n              <div><label className=\"block text-sm font-medium text-slate-700 mb-1\">Equipment Type</label><select className=\"w-full px-4 py-2 border border-slate-200 rounded-lg\"><option>HVAC</option><option>Furnace</option><option>Water Heater</option><option>Boiler</option><option>Other</option></select></div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div><label className=\"block text-sm font-medium text-slate-700 mb-1\">Brand</label><input type=\"text\" placeholder=\"Carrier\" className=\"w-full px-4 py-2 border border-slate-200 rounded-lg\" /></div>\n                <div><label className=\"block text-sm font-medium text-slate-700 mb-1\">Model</label><input type=\"text\" placeholder=\"24ACC636A003\" className=\"w-full px-4 py-2 border border-slate-200 rounded-lg\" /></div>\n              </div>\n              <div><label className=\"block text-sm font-medium text-slate-700 mb-1\">Serial Number</label><input type=\"text\" placeholder=\"CAR-2024-78542\" className=\"w-full px-4 py-2 border border-slate-200 rounded-lg\" /></div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div><label className=\"block text-sm font-medium text-slate-700 mb-1\">Install Date</label><input type=\"date\" className=\"w-full px-4 py-2 border border-slate-200 rounded-lg\" /></div>\n                <div><label className=\"block text-sm font-medium text-slate-700 mb-1\">Warranty Expires</label><input type=\"date\" className=\"w-full px-4 py-2 border border-slate-200 rounded-lg\" /></div>\n              </div>\n              <div className=\"flex gap-3\">\n                <button onClick={() => setShowAddEquipment(false)} className=\"flex-1 py-2 border border-slate-200 text-slate-700 rounded-lg hover:bg-slate-50\">Cancel</button>\n                <button onClick={() => { setShowAddEquipment(false); alert('Equipment added!'); }} className=\"flex-1 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600\">Add Equipment</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ServiceAgreements;"
  }
}